# AIæ™ºèƒ½èŠå¤©ç³»ç»Ÿ - å¼€å‘æŒ‡å—

> ç‰ˆæœ¬ï¼šv3.0  
> æ›´æ–°æ—¶é—´ï¼š2025å¹´9æœˆ  
> åŸºäºé‡æ„åçš„å¤šAIæä¾›å•†å“åº”å¼æ¶æ„

## ğŸ›  å¼€å‘ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
- **JDK**: 17+
- **Maven**: 3.8+
- **Node.js**: 18+
- **npm**: 8+
- **PostgreSQL**: 14+ (ç”Ÿäº§ç¯å¢ƒ)

### æ¨èIDE
- **åç«¯**: IntelliJ IDEA Ultimate / VS Code
- **å‰ç«¯**: VS Code / WebStorm
- **æ•°æ®åº“**: DBeaver / pgAdmin

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd springai
```

### 2. ç¯å¢ƒé…ç½®
```bash
# æ•°æ®åº“é…ç½® (PostgreSQL)
export DB_URL="jdbc:postgresql://localhost:5432/ai_chat"
export DB_USERNAME="ai_chat_user"
export DB_PASSWORD="your_password"

# å¤šAIæä¾›å•†é…ç½®
export OPENAI_API_KEY="sk-your-openai-key"
export KIMI_API_KEY="sk-your-kimi-key"
export DEEPSEEK_API_KEY="sk-your-deepseek-key"

# æœç´¢APIé…ç½®
export TAVILY_API_KEY="tvly-your-tavily-key"
```

### 3. æ•°æ®åº“åˆå§‹åŒ–
```bash
# åˆ›å»ºæ•°æ®åº“
createdb ai_chat

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
psql -d ai_chat -f src/main/resources/database/init.sql
```

### 4. åç«¯å¯åŠ¨
```bash
# Mavenæ–¹å¼
mvn clean install
mvn spring-boot:run

# æˆ–ç›´æ¥è¿è¡Œ
mvn clean package
java -jar target/ai-chat-0.0.1-SNAPSHOT.jar
```

### 5. å‰ç«¯å¯åŠ¨
```bash
cd frontend
npm install
npm run dev
```

### 6. è®¿é—®åº”ç”¨
- **å‰ç«¯åº”ç”¨**: http://localhost:3000
- **åç«¯API**: http://localhost:8080
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/actuator/health
- **APIæ–‡æ¡£**: http://localhost:8080/swagger-ui.html

## ğŸ“ é¡¹ç›®æ¶æ„

### åç«¯æ¨¡å—ç»“æ„
```
src/main/java/com/example/
â”œâ”€â”€ controller/                # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ ChatController.java           # æµå¼èŠå¤©æ¥å£
â”‚   â”œâ”€â”€ ConversationController.java   # å¯¹è¯ç®¡ç†
â”‚   â”œâ”€â”€ ModelController.java          # æ¨¡å‹ç®¡ç†
â”‚   â””â”€â”€ UserController.java           # ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ service/                   # ä¸šåŠ¡é€»è¾‘å±‚  
â”‚   â”œâ”€â”€ impl/                         # å®ç°ç±»
â”‚   â”‚   â”œâ”€â”€ AiChatServiceImpl.java           # ä¸»åè°ƒå™¨(152è¡Œ)
â”‚   â”‚   â”œâ”€â”€ ConversationServiceImpl.java     # å¯¹è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ MessageServiceImpl.java          # æ¶ˆæ¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ SearchServiceImpl.java           # æœç´¢æœåŠ¡
â”‚   â”œâ”€â”€ provider/                     # AIæä¾›å•†æŠ½è±¡
â”‚   â”‚   â”œâ”€â”€ ModelProvider.java               # ç»Ÿä¸€æ¥å£
â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚       â”œâ”€â”€ OpenaiModelProvider.java    # OpenAIå®ç°
â”‚   â”‚       â”œâ”€â”€ Kimi2ModelProvider.java     # Kimiå®ç°
â”‚   â”‚       â”œâ”€â”€ DeepSeekModelProvider.java  # DeepSeekå®ç°
â”‚   â”‚       â””â”€â”€ QwenModelProvider.java      # é€šä¹‰åƒé—®å®ç°
â”‚   â”œâ”€â”€ factory/                      # å·¥å‚æ¨¡å¼ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ModelProviderFactory.java       # æä¾›å•†å·¥å‚
â”‚   â”‚   â”œâ”€â”€ ProviderRegistry.java           # æä¾›å•†æ³¨å†Œè¡¨
â”‚   â”‚   â””â”€â”€ ProviderSelectionStrategy.java  # é€‰æ‹©ç­–ç•¥
â”‚   â””â”€â”€ chat/                         # èŠå¤©ç»„ä»¶æ¨¡å—
â”‚       â”œâ”€â”€ PromptBuilder.java              # æç¤ºè¯æ„å»º
â”‚       â”œâ”€â”€ ModelSelector.java              # æ¨¡å‹é€‰æ‹©å™¨
â”‚       â””â”€â”€ ChatErrorHandler.java           # é”™è¯¯å¤„ç†å™¨
â”œâ”€â”€ entity/                    # æ•°æ®å®ä½“
â”œâ”€â”€ mapper/                    # MyBatisæ˜ å°„å™¨
â”œâ”€â”€ dto/                      # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ request/                      # è¯·æ±‚DTO
â”‚   â”œâ”€â”€ response/                     # å“åº”DTO
â”‚   â””â”€â”€ common/                       # é€šç”¨DTO
â”œâ”€â”€ config/                   # é…ç½®ç±»
â”‚   â”œâ”€â”€ SearchProperties.java         # æœç´¢é…ç½®
â”‚   â”œâ”€â”€ ModelScopeProperties.java     # ModelScopeé…ç½®
â”‚   â””â”€â”€ ChatStreamingProperties.java  # æµå¼é…ç½®
â””â”€â”€ exception/                # å¼‚å¸¸å¤„ç†
```

### å‰ç«¯æ¨¡å—ç»“æ„
```
frontend/src/
â”œâ”€â”€ components/               # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ ChatContainer.vue         # èŠå¤©å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ MessageList.vue           # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ MessageInput.vue          # è¾“å…¥ç»„ä»¶
â”‚   â”‚   â””â”€â”€ MarkdownRenderer.vue      # åŸç”ŸMarkdownæ¸²æŸ“
â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â””â”€â”€ ConversationList.vue      # å¯¹è¯åˆ—è¡¨
â”‚   â””â”€â”€ model/
â”‚       â””â”€â”€ ModelSelector.vue         # æ¨¡å‹é€‰æ‹©å™¨
â”œâ”€â”€ stores/                   # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ chat.js                       # èŠå¤©çŠ¶æ€
â”‚   â”œâ”€â”€ conversation.js               # å¯¹è¯çŠ¶æ€
â”‚   â””â”€â”€ model.js                      # æ¨¡å‹çŠ¶æ€
â”œâ”€â”€ api/                      # APIæ¥å£å°è£…
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â””â”€â”€ assets/                   # é™æ€èµ„æº
```

## ğŸ“ å¼€å‘è§„èŒƒ

### é˜¿é‡Œå·´å·´Javaå¼€å‘è§„èŒƒ

#### ç¼–ç è§„èŒƒ
```java
/**
 * æœåŠ¡å®ç°ç±»ç¤ºä¾‹ - éµå¾ªé˜¿é‡Œå·´å·´è§„èŒƒ
 * 
 * @author xupeng
 */
@Slf4j
@Service
@RequiredArgsConstructor  // æ„é€ å™¨æ³¨å…¥ï¼Œä¸ä½¿ç”¨@Autowired
public class ExampleServiceImpl implements ExampleService {
    
    private final ExampleRepository repository;
    private final ExampleProperties properties;  // é…ç½®å±æ€§ç±»ï¼Œä¸ä½¿ç”¨@Value
    
    @Override
    public Mono<ExampleDto> processAsync(Long id) {
        // ã€å¼ºåˆ¶ã€‘ä½¿ç”¨Objects.requireNonNullè¿›è¡Œå‚æ•°æ ¡éªŒ
        Objects.requireNonNull(id, "IDä¸èƒ½ä¸ºnull");
        
        log.info("å¼€å§‹å¤„ç†è¯·æ±‚ï¼ŒID: {}", id);
        
        return repository.findById(id)
                .switchIfEmpty(Mono.error(new BusinessException("æ•°æ®ä¸å­˜åœ¨")))
                .map(this::convertToDto)
                .doOnSuccess(result -> log.info("å¤„ç†å®Œæˆï¼Œç»“æœ: {}", result))
                .doOnError(error -> log.error("å¤„ç†å¤±è´¥", error));
    }
    
    private ExampleDto convertToDto(Example entity) {
        // ä¸šåŠ¡é€»è¾‘å¤„ç†
        return ExampleDto.builder()
                .id(entity.getId())
                .name(entity.getName())
                .build();
    }
}
```

#### é…ç½®å±æ€§ç±»è§„èŒƒ
```java
/**
 * é…ç½®å±æ€§ç±» - æ›¿ä»£@Valueæ³¨å…¥
 * 
 * @author xupeng
 */
@Data
@Component
@ConfigurationProperties(prefix = "app.example")
public class ExampleProperties {
    
    /**
     * APIå¯†é’¥
     */
    private String apiKey;
    
    /**
     * è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
     */
    private int timeout = 30000;
    
    /**
     * æ˜¯å¦å¯ç”¨åŠŸèƒ½
     */
    private boolean enabled = true;
}
```

#### å“åº”å¼ç¼–ç¨‹è§„èŒƒ
```java
/**
 * å“åº”å¼ç¼–ç¨‹ç¤ºä¾‹
 */
@Service
@RequiredArgsConstructor
public class ReactiveExampleService {
    
    private final WebClient webClient;
    
    public Flux<String> streamData(String query) {
        return webClient.get()
                .uri("/api/stream", query)
                .retrieve()
                .bodyToFlux(String.class)
                // é”™è¯¯å¤„ç†
                .onErrorResume(error -> {
                    log.error("æµå¼è¯·æ±‚å¤±è´¥", error);
                    return Flux.just("ERROR: " + error.getMessage());
                })
                // èƒŒå‹å¤„ç†
                .onBackpressureBuffer(1000)
                // è¶…æ—¶å¤„ç†
                .timeout(Duration.ofMinutes(2));
    }
}
```

### å‰ç«¯å¼€å‘è§„èŒƒ

#### Vue 3 Composition API
```vue
<template>
  <div class="chat-container">
    <MessageList :messages="messages" />
    <MessageInput @send="handleSend" />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useChatStore } from '@/stores/chat'
import MessageList from './MessageList.vue'
import MessageInput from './MessageInput.vue'

// Props
const props = defineProps({
  conversationId: {
    type: Number,
    required: true
  }
})

// Store
const chatStore = useChatStore()

// å“åº”å¼æ•°æ®
const messages = computed(() => chatStore.messages)
const isLoading = ref(false)
const sseConnection = ref(null)

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  initSSEConnection()
})

onUnmounted(() => {
  closeSSEConnection()
})

// æ–¹æ³•
const handleSend = async (message) => {
  try {
    isLoading.value = true
    await chatStore.sendMessage(props.conversationId, message)
  } catch (error) {
    ElMessage.error('å‘é€å¤±è´¥: ' + error.message)
  } finally {
    isLoading.value = false
  }
}

const initSSEConnection = () => {
  const url = `/api/chat/stream?conversationId=${props.conversationId}`
  sseConnection.value = new EventSource(url)
  
  sseConnection.value.onmessage = (event) => {
    const data = JSON.parse(event.data)
    chatStore.handleStreamMessage(data)
  }
  
  sseConnection.value.onerror = () => {
    ElMessage.error('è¿æ¥æ–­å¼€ï¼Œè¯·é‡è¯•')
  }
}

const closeSSEConnection = () => {
  if (sseConnection.value) {
    sseConnection.value.close()
    sseConnection.value = null
  }
}
</script>

<style scoped>
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
}
</style>
```

#### åŸç”ŸMarkdownæ¸²æŸ“å®ç°
```vue
<!-- MarkdownRenderer.vue - æ›¿ä»£v-md-editor -->
<template>
  <div class="markdown-content" v-html="renderedHtml"></div>
</template>

<script setup>
import { computed } from 'vue'
import { marked } from 'marked'
import hljs from 'highlight.js'
import 'highlight.js/styles/github.css'

const props = defineProps({
  content: {
    type: String,
    default: ''
  }
})

// é…ç½®marked
marked.setOptions({
  highlight: function(code, lang) {
    if (lang && hljs.getLanguage(lang)) {
      return hljs.highlight(code, { language: lang }).value
    }
    return hljs.highlightAuto(code).value
  },
  breaks: true,
  gfm: true,
  tables: true
})

const renderedHtml = computed(() => {
  if (!props.content) return ''
  return marked(props.content)
})
</script>

<style scoped>
.markdown-content {
  line-height: 1.6;
  color: #333;
}

/* ä»£ç å—æ ·å¼ */
.markdown-content pre {
  background-color: #f6f8fa;
  border-radius: 6px;
  padding: 16px;
  overflow-x: auto;
}

.markdown-content code {
  background-color: rgba(175, 184, 193, 0.2);
  padding: 2px 4px;
  border-radius: 3px;
  font-size: 85%;
}

/* è¡¨æ ¼æ ·å¼ */
.markdown-content table {
  border-collapse: collapse;
  width: 100%;
  margin: 16px 0;
}

.markdown-content th,
.markdown-content td {
  border: 1px solid #d0d7de;
  padding: 8px 12px;
  text-align: left;
}

.markdown-content th {
  background-color: #f6f8fa;
  font-weight: 600;
}
</style>
```

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®

### IntelliJ IDEAé…ç½®
1. **å¿…è¦æ’ä»¶**:
   - Lombok Plugin
   - MyBatisX
   - Vue.js Plugin
   - Database Navigator

2. **ä»£ç è§„èŒƒ**:
   - File â†’ Settings â†’ Editor â†’ Code Style â†’ Java
   - å¯¼å…¥é˜¿é‡Œå·´å·´Javaä»£ç è§„èŒƒé…ç½®

3. **æ•°æ®åº“é…ç½®**:
   - æ·»åŠ PostgreSQLæ•°æ®æº
   - é…ç½®è¿æ¥æ± å‚æ•°

### VS Codeé…ç½®
æ¨èæ’ä»¶:
```json
{
  "recommendations": [
    "Vue.volar",
    "Vue.vscode-typescript-vue-plugin", 
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-postgresql"
  ]
}
```

## ğŸ› è°ƒè¯•æŒ‡å—

### åç«¯è°ƒè¯•

#### å“åº”å¼è°ƒè¯•
```java
// å¯ç”¨Reactorè°ƒè¯•
static {
    BlockHoundIntegration.builder()
        .with(new ReactorNettyIntegration())
        .install();
}

// è°ƒè¯•æµå¼å¤„ç†
public Flux<String> debugStream() {
    return Flux.just("a", "b", "c")
        .doOnNext(item -> log.debug("å¤„ç†é¡¹ç›®: {}", item))
        .doOnError(error -> log.error("æµå¤„ç†é”™è¯¯", error))
        .doOnComplete(() -> log.debug("æµå¤„ç†å®Œæˆ"));
}
```

#### æ—¥å¿—é…ç½®
```yaml
# application-dev.yml
logging:
  level:
    com.example: DEBUG
    com.example.service.chat: TRACE
    reactor.netty: DEBUG
    org.springframework.web.reactive: DEBUG
```

#### æ•°æ®åº“è°ƒè¯•
```yaml
# æ˜¾ç¤ºSQLè¯­å¥
mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# PostgreSQLè¿æ¥è°ƒè¯•
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/ai_chat?loggerLevel=DEBUG
```

### å‰ç«¯è°ƒè¯•

#### SSEè¿æ¥è°ƒè¯•
```javascript
// stores/chat.js
export const useChatStore = defineStore('chat', {
  state: () => ({
    sseConnection: null,
    connectionStatus: 'disconnected'
  }),
  
  actions: {
    initSSE(conversationId) {
      const url = `/api/chat/stream?conversationId=${conversationId}`
      console.log('ğŸ”Œ æ­£åœ¨å»ºç«‹SSEè¿æ¥:', url)
      
      this.sseConnection = new EventSource(url)
      
      this.sseConnection.onopen = () => {
        console.log('âœ… SSEè¿æ¥å·²å»ºç«‹')
        this.connectionStatus = 'connected'
      }
      
      this.sseConnection.onmessage = (event) => {
        console.log('ğŸ“¥ æ”¶åˆ°SSEæ¶ˆæ¯:', event.data)
        this.handleMessage(JSON.parse(event.data))
      }
      
      this.sseConnection.onerror = (error) => {
        console.error('âŒ SSEè¿æ¥é”™è¯¯:', error)
        this.connectionStatus = 'error'
      }
    }
  }
})
```

#### Vue DevToolsé…ç½®
```javascript
// main.js
const app = createApp(App)

if (process.env.NODE_ENV === 'development') {
  app.config.devtools = true
  app.config.debug = true
}
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### åç«¯æµ‹è¯•

#### å•å…ƒæµ‹è¯•ç¤ºä¾‹
```java
@ExtendWith(MockitoExtension.class)
class AiChatServiceImplTest {
    
    @Mock
    private ModelSelector modelSelector;
    
    @Mock
    private PromptBuilder promptBuilder;
    
    @InjectMocks
    private AiChatServiceImpl aiChatService;
    
    @Test
    void shouldHandleStreamChat() {
        // Given
        when(modelSelector.selectModel(anyString(), anyString(), anyLong()))
            .thenReturn(new ModelSelection("openai", "gpt-3.5-turbo"));
        
        when(promptBuilder.buildPrompt(anyLong(), anyString(), anyBoolean()))
            .thenReturn(Mono.just("test prompt"));
        
        // When
        Flux<SseEventResponse> result = aiChatService.streamChatWithModel(
            1L, "test message", false, false, 1L, "openai", "gpt-3.5-turbo");
        
        // Then
        StepVerifier.create(result)
            .expectNextCount(1)
            .verifyComplete();
    }
}
```

#### é›†æˆæµ‹è¯•
```java
@SpringBootTest
@TestPropertySource(properties = {
    "spring.datasource.url=jdbc:h2:mem:testdb",
    "spring.ai.openai.api-key=test-key"
})
class ChatControllerIntegrationTest {
    
    @Autowired
    private WebTestClient webTestClient;
    
    @Test
    void shouldStreamChat() {
        webTestClient.get()
            .uri("/api/chat/stream?conversationId=1&message=hello")
            .accept(MediaType.TEXT_EVENT_STREAM)
            .exchange()
            .expectStatus().isOk()
            .expectHeader().contentType(MediaType.TEXT_EVENT_STREAM)
            .expectBodyList(String.class)
            .hasSize(greaterThan(0));
    }
}
```

### å‰ç«¯æµ‹è¯•

#### Vueç»„ä»¶æµ‹è¯•
```javascript
// tests/components/MessageList.test.js
import { mount } from '@vue/test-utils'
import MessageList from '@/components/chat/MessageList.vue'

describe('MessageList', () => {
  it('should render messages correctly', () => {
    const messages = [
      { id: 1, role: 'user', content: 'Hello' },
      { id: 2, role: 'assistant', content: 'Hi there!' }
    ]
    
    const wrapper = mount(MessageList, {
      props: { messages }
    })
    
    expect(wrapper.findAll('.message')).toHaveLength(2)
    expect(wrapper.text()).toContain('Hello')
    expect(wrapper.text()).toContain('Hi there!')
  })
})
```

#### E2Eæµ‹è¯•
```javascript
// tests/e2e/chat.spec.js
import { test, expect } from '@playwright/test'

test('should send and receive messages', async ({ page }) => {
  await page.goto('/')
  
  // å‘é€æ¶ˆæ¯
  await page.fill('[data-testid="message-input"]', 'Hello AI')
  await page.click('[data-testid="send-button"]')
  
  // éªŒè¯æ¶ˆæ¯æ˜¾ç¤º
  await expect(page.locator('.message-user')).toContainText('Hello AI')
  
  // ç­‰å¾…AIå›å¤
  await expect(page.locator('.message-assistant')).toBeVisible()
})
```

## ğŸ“¦ æ„å»ºå’Œéƒ¨ç½²

### æœ¬åœ°æ„å»º
```bash
# å®Œæ•´æ„å»ºæµç¨‹
./build.sh

# æˆ–æ‰‹åŠ¨æ„å»º
mvn clean package -DskipTests
cd frontend && npm run build
cp -r frontend/dist/* src/main/resources/static/
mvn spring-boot:repackage
```

### Dockeréƒ¨ç½²
```dockerfile
# Dockerfile
FROM openjdk:17-jdk-alpine

VOLUME /tmp

# å®‰è£…PostgreSQLå®¢æˆ·ç«¯
RUN apk add --no-cache postgresql-client

COPY target/ai-chat-*.jar app.jar

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: postgres:14-alpine
    environment:
      POSTGRES_DB: ai_chat
      POSTGRES_USER: ai_chat_user
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      
  ai-chat:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DB_URL=jdbc:postgresql://postgres:5432/ai_chat
      - DB_USERNAME=ai_chat_user
      - DB_PASSWORD=password
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - TAVILY_API_KEY=${TAVILY_API_KEY}
    depends_on:
      - postgres

volumes:
  postgres_data:
```

## ğŸ” æ€§èƒ½ä¼˜åŒ–

### å“åº”å¼æ€§èƒ½ä¼˜åŒ–
```java
@Configuration
public class WebFluxConfig implements WebFluxConfigurer {
    
    @Bean
    public WebClient webClient() {
        ConnectionProvider provider = ConnectionProvider.builder("ai-providers")
            .maxConnections(100)
            .maxIdleTime(Duration.ofSeconds(30))
            .maxLifeTime(Duration.ofMinutes(5))
            .pendingAcquireTimeout(Duration.ofSeconds(10))
            .evictInBackground(Duration.ofSeconds(10))
            .build();
            
        return WebClient.builder()
            .clientConnector(new ReactorClientHttpConnector(
                HttpClient.create(provider)))
            .build();
    }
}
```

### PostgreSQLä¼˜åŒ–
```sql
-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX CONCURRENTLY idx_messages_conversation_created 
ON messages(conversation_id, created_at);

CREATE INDEX CONCURRENTLY idx_messages_content_gin 
ON messages USING gin(to_tsvector('english', content));

-- è¿æ¥æ± é…ç½®
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
```

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–
```javascript
// è™šæ‹Ÿæ»šåŠ¨å®ç°
import { VirtualList } from '@tanstack/vue-virtual'

// é˜²æŠ–ä¼˜åŒ–
import { debounce } from 'lodash-es'

const searchMessages = debounce(async (query) => {
  // æœç´¢é€»è¾‘
}, 300)

// æ‡’åŠ è½½ç»„ä»¶
const ModelSelector = defineAsyncComponent(() => 
  import('@/components/model/ModelSelector.vue')
)
```

## ğŸ›¡ å®‰å…¨æœ€ä½³å®è·µ

### åç«¯å®‰å…¨
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(ServerHttpSecurity http) {
        return http
            .csrf(csrf -> csrf.disable())
            .cors(cors -> cors.configurationSource(corsConfigurationSource()))
            .authorizeHttpRequests(auth -> auth
                .pathMatchers("/api/public/**").permitAll()
                .anyExchange().authenticated()
            )
            .build();
    }
}

// è¾“å…¥éªŒè¯
@RestController
@Validated
public class ChatController {
    
    @PostMapping("/send")
    public Mono<ApiResponse> sendMessage(
            @Valid @RequestBody ChatRequest request) {
        // è¯·æ±‚å·²é€šè¿‡@ValidéªŒè¯
        return chatService.processMessage(request);
    }
}
```

### å‰ç«¯å®‰å…¨
```javascript
// XSSé˜²æŠ¤
const sanitizeHtml = (html) => {
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'code', 'pre'],
    ALLOWED_ATTR: []
  })
}

// APIå¯†é’¥å®‰å…¨
// âŒ é”™è¯¯ - ä¸è¦åœ¨å‰ç«¯å­˜å‚¨APIå¯†é’¥
const apiKey = 'sk-xxx'

// âœ… æ­£ç¡® - é€šè¿‡åç«¯ä»£ç†
const callAI = (message) => {
  return axios.post('/api/chat', { message })
}
```

## ğŸ“š æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„AIæä¾›å•†
```java
@Service
public class NewAIProvider implements ModelProvider {
    
    private final WebClient webClient;
    private final NewAIProperties properties;
    
    @Override
    public Flux<SseEventResponse> streamChat(ChatRequest request) {
        return webClient.post()
            .uri(properties.getApiUrl())
            .headers(this::setAuthHeaders)
            .bodyValue(buildRequestBody(request))
            .retrieve()
            .bodyToFlux(String.class)
            .map(this::parseResponse);
    }
    
    @Override
    public String getProviderName() {
        return "newai";
    }
}

// é…ç½®å±æ€§
@Data
@Component  
@ConfigurationProperties(prefix = "newai")
public class NewAIProperties {
    private String apiKey;
    private String apiUrl;
    private String defaultModel;
}
```

### è‡ªå®šä¹‰é”™è¯¯å¤„ç†
```java
@Service
public class CustomChatErrorHandler implements ChatErrorHandler {
    
    @Override
    public Flux<SseEventResponse> handleChatError(Throwable error) {
        ErrorType errorType = classifyError(error);
        
        return switch (errorType) {
            case RATE_LIMIT_ERROR -> handleRateLimitError(error);
            case API_KEY_ERROR -> handleApiKeyError(error);
            case QUOTA_EXCEEDED -> handleQuotaError(error);
            default -> handleGenericError(error);
        };
    }
}
```

## â“ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜è§£å†³

#### 1. PostgreSQLè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
systemctl status postgresql

# éªŒè¯è¿æ¥
psql -h localhost -U ai_chat_user -d ai_chat -c "SELECT version();"

# æ£€æŸ¥è¿æ¥é…ç½®
grep -r "jdbc:postgresql" src/main/resources/
```

#### 2. AI APIè°ƒç”¨å¤±è´¥
```java
// æ·»åŠ è¯¦ç»†æ—¥å¿—
@Slf4j
@Component
public class AIApiHealthCheck {
    
    @EventListener
    @Async
    public void handleProviderError(ProviderErrorEvent event) {
        log.error("AIæä¾›å•† {} è°ƒç”¨å¤±è´¥: {}", 
            event.getProviderName(), event.getError().getMessage());
            
        // å‘é€å‘Šè­¦é€šçŸ¥
        alertService.sendAlert("AIæä¾›å•†å¼‚å¸¸", event);
    }
}
```

#### 3. SSEè¿æ¥å¼‚å¸¸
```javascript
// å‰ç«¯è¿æ¥ç›‘æ§
const monitorSSEConnection = (eventSource) => {
  let reconnectCount = 0
  const maxReconnects = 5
  
  const reconnect = () => {
    if (reconnectCount < maxReconnects) {
      setTimeout(() => {
        reconnectCount++
        console.log(`å°è¯•é‡è¿ (${reconnectCount}/${maxReconnects})`)
        initSSEConnection()
      }, 1000 * reconnectCount)
    } else {
      ElMessage.error('è¿æ¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
    }
  }
  
  eventSource.onerror = (error) => {
    console.error('SSEè¿æ¥é”™è¯¯:', error)
    reconnect()
  }
}
```

#### 4. æ€§èƒ½é—®é¢˜è¯Šæ–­
```bash
# JVMæ€§èƒ½ç›‘æ§
jconsole
# æˆ–è€…
java -XX:+FlightRecorder -XX:StartFlightRecording=duration=60s,filename=app.jfr -jar app.jar

# PostgreSQLæ€§èƒ½åˆ†æ
EXPLAIN ANALYZE SELECT * FROM messages WHERE conversation_id = 1;

# å‰ç«¯æ€§èƒ½åˆ†æ
npm run build -- --analyze
```

---

**å¼€å‘æ”¯æŒ**: å¦‚é‡åˆ°å¼€å‘é—®é¢˜ï¼Œè¯·æŸ¥é˜…ç›¸å…³æŠ€æœ¯æ–‡æ¡£æˆ–æäº¤Issue  
**ä»£ç è´¡çŒ®**: æ¬¢è¿æäº¤PRï¼Œè¯·ç¡®ä¿éµå¾ªå¼€å‘è§„èŒƒå’Œæµ‹è¯•è¦†ç›–ç‡è¦æ±‚  
**æŠ€æœ¯è®¨è®º**: å¯åœ¨é¡¹ç›®DiscussionåŒºåŸŸè¿›è¡ŒæŠ€æœ¯äº¤æµ